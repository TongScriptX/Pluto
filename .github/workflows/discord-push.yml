name: üîî Discord Commit Notifier

on:
  push:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 2

      - name: Parse commit and send embed
        run: |
          COMMIT_MESSAGE=$(git log -1 --pretty=%s)
          FILES=$(git diff --name-only HEAD^ HEAD)
          FILE_NAMES=$(echo "$FILES" | xargs -n1 basename | paste -sd ", " -)

          JSON=$(jq -n --arg title "üì¶ Êõ¥Êñ∞ÂÜÖÂÆπ" \
                       --arg description "$COMMIT_MESSAGE" \
                       --arg files "$FILE_NAMES" \
                       '{
                          "embeds": [
                            {
                              "title": $title,
                              "description": $description,
                              "fields": [
                                {
                                  "name": "üóÇÔ∏è Ê∂âÂèäÊñá‰ª∂",
                                  "value": ($files // "Êó†")
                                }
                              ],
                              "color": 14540253
                            }
                          ]
                        }')

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$JSON" \
               ${{ secrets.DISCORD_GITHUB_UPDATE }}