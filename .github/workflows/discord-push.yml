name: 🔔 Discord Commit Notifier (filename only)

on:
  push:
    paths-ignore:
      - '.github/**'

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Extract changed filenames
        id: files
        run: |
          names=$(git diff --name-only HEAD^ HEAD | xargs -n1 basename | paste -sd ', ' -)
          echo "list=$names" >> $GITHUB_OUTPUT

      - name: Send Discord embed with commit info
        uses: hugoalh/send-discord-webhook-ghaction@v7.0.0
        with:
          key: ${{ secrets.DISCORD_GITHUB_UPDATE }}
          embeds: |
            - title: 🔔 新提交到 Pluto
              description: |
                ```
                ${{ github.event.head_commit.message }}
                ```
              color: #57F287
              fields:
                - name: 修改文件
                  value: ${{ steps.files.outputs.list }}
                  inline: false