name: 🔔 Discord Commit Notifier (filename only)

on:
  push:
    paths-ignore:
      - '.github/**'

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Gather changed filenames
        id: files
        run: |
          names=$(git diff --name-only HEAD^ HEAD | xargs -n1 basename | paste -sd ', ' -)
          echo "::set-output name=list::$names"

      - name: Send Discord embed
        uses: MineBartekSA/discord-webhook@v2
        with:
          webhook: ${{ secrets.DISCORD_GITHUB_UPDATE }}
          embed: |
            title: 🔔 新提交到 Pluto
            color: 3066993
            description: |
              ```text
              ${{ github.event.head_commit.message }}
              ```
            fields:
              - name: 修改文件
                value: ${{ steps.files.outputs.list }}
                inline: false